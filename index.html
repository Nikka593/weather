<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather TimeMachine</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Noto+Sans+JP:wght@400;500;700&family=Orbitron:wght@700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .font-orbitron {
            font-family: 'Orbitron', sans-serif;
        }
        /* „Éà„É©„É≥„Ç∏„Ç∑„Éß„É≥ÂäπÊûú */
        .weather-card, .skeleton-card, .geo-card {
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        .weather-card:hover, .geo-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
        }
        /* „Çπ„Ç±„É´„Éà„É≥„É≠„Éº„Éá„Ç£„É≥„Ç∞„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
        @keyframes pulse {
            50% { opacity: .5; }
        }
        .skeleton-card .pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        /* „Ç´„Çπ„Çø„É†„Çπ„ÇØ„É≠„Éº„É´„Éê„Éº */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 transition-colors duration-500">

    <div class="container mx-auto p-4 md:p-8 max-w-7xl">
        
        <section class="mb-12 text-center">
            <img src="https://storage.googleapis.com/gemini-prod-us-west1-assets/images/2024/7/17/7a935403-f01f-4318-8f0a-2895f329d91f.jpg" alt="Âú∞Â±§„Å®Â§©Ê∞ó„ÅÆ„Ç§„É°„Éº„Ç∏" class="w-full max-w-4xl mx-auto rounded-lg shadow-xl mb-6">
            <p id="intro-text" class="text-xl text-gray-700 dark:text-gray-300"></p>
        </section>

        <header class="flex flex-col md:flex-row justify-between items-center mb-8">
            <h1 id="main-title" class="text-4xl md:text-5xl font-bold text-gray-900 dark:text-white mb-4 md:mb-0 font-orbitron">
            </h1>
            <div class="flex flex-col sm:flex-row items-center gap-4">
                <select id="language-selector" class="bg-white dark:bg-gray-800 border-2 border-gray-300 dark:border-gray-700 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                    <option value="ja">Êó•Êú¨Ë™û</option>
                    <option value="en">English</option>
                </select>
                <input type="date" id="date-picker" class="bg-white dark:bg-gray-800 border-2 border-gray-300 dark:border-gray-700 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                <select id="location-selector" class="bg-white dark:bg-gray-800 border-2 border-gray-300 dark:border-gray-700 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 transition w-48">
                    <optgroup id="japan-locations" label="Japan"></optgroup>
                    <optgroup id="scifi-locations" label="Sci-Fi Cities"></optgroup>
                    <optgroup id="geology-locations" label="Geological Ages"></optgroup>
                </select>
            </div>
        </header>

        <main id="weather-cards-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-6">
            </main>

        <footer class="mt-12 text-center">
            <div id="trivia-container" class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md transition-all duration-500 opacity-0">
                <h3 id="trivia-title" class="font-bold text-lg mb-2 text-blue-500 dark:text-blue-400 font-orbitron"></h3>
                <p id="trivia-text" class="text-gray-600 dark:text-gray-400 italic"></p>
            </div>
        </footer>
    </div>

    <script>
        // DOMË¶ÅÁ¥†„ÅÆÂèñÂæó
        const datePicker = document.getElementById('date-picker');
        const locationSelector = document.getElementById('location-selector');
        const languageSelector = document.getElementById('language-selector');
        const cardsContainer = document.getElementById('weather-cards-container');
        const triviaContainer = document.getElementById('trivia-container');
        // „ÉÜ„Ç≠„Çπ„ÉàË¶ÅÁ¥†
        const introText = document.getElementById('intro-text');
        const mainTitle = document.getElementById('main-title');
        const triviaTitle = document.getElementById('trivia-title');
        const triviaText = document.getElementById('trivia-text'); // FIX: Added this line
        const japanLocationsGroup = document.getElementById('japan-locations');
        const scifiLocationsGroup = document.getElementById('scifi-locations');
        const geologyLocationsGroup = document.getElementById('geology-locations');

        let currentLang = 'ja';

        // Â§öË®ÄË™ûÂØæÂøú„ÉÜ„Ç≠„Çπ„Éà
        const translations = {
            ja: {
                intro: "„Äå‰ªäÊó•„Äç„Åã„Çâ„Äå46ÂÑÑÂπ¥Ââç„Äç„Åæ„Åß„ÄÅÊôÇÁ©∫„ÇíË∂Ö„Åà„Çã„ÅäÂ§©Ê∞ó„ÅÆÊóÖ„Å∏Âá∫„Åã„Åë„Çà„ÅÜ„ÄÇ",
                title: "Weather TimeMachine",
                didYouKnow: "Ë±ÜÁü•Ë≠ò",
                labels: { today: "‰ªäÊó•", yearsAgo: "{n}Âπ¥Ââç" },
                locationGroups: { japan: "Êó•Êú¨", scifi: "SFÈÉΩÂ∏Ç", geology: "Âú∞Ë≥™ÊôÇ‰ª£" },
                weatherCodes: { 0: "Âø´Êô¥", 1: "„Åª„ÅºÂø´Êô¥", 2: "‰∏ÄÈÉ®Êõá„Çä", 3: "Êõá„Çä", 45: "Èúß", 48: "ÈúßÊ∞∑", 51: "Âº±„ÅÑÈúßÈõ®", 53: "ÈúßÈõ®", 55: "Âº∑„ÅÑÈúßÈõ®", 61: "Â∞èÈõ®", 63: "Èõ®", 65: "Â§ßÈõ®", 80: "Âº±„ÅÑ„Å´„Çè„ÅãÈõ®", 81: "„Å´„Çè„ÅãÈõ®", 82: "ÊøÄ„Åó„ÅÑ„Å´„Çè„ÅãÈõ®", 95: "Èõ∑Èõ®" },
                locationNames: { hokkaido: "ÂåóÊµ∑ÈÅì", aomori: "ÈùíÊ£Æ", iwate: "Â≤©Êâã", miyagi: "ÂÆÆÂüé", akita: "ÁßãÁî∞", yamagata: "Â±±ÂΩ¢", fukushima: "Á¶èÂ≥∂", ibaraki: "Ëå®Âüé", tochigi: "Ê†ÉÊú®", gunma: "Áæ§È¶¨", saitama: "ÂüºÁéâ", chiba: "ÂçÉËëâ", tokyo: "Êù±‰∫¨", kanagawa: "Á•ûÂ•àÂ∑ù", niigata: "Êñ∞ÊΩü", toyama: "ÂØåÂ±±", ishikawa: "Áü≥Â∑ù", fukui: "Á¶è‰∫ï", yamanashi: "Â±±Ê¢®", nagano: "Èï∑Èáé", gifu: "Â≤êÈòú", shizuoka: "ÈùôÂ≤°", aichi: "ÊÑõÁü•", mie: "‰∏âÈáç", shiga: "ÊªãË≥Ä", kyoto: "‰∫¨ÈÉΩ", osaka: "Â§ßÈò™", hyogo: "ÂÖµÂ∫´", nara: "Â•àËâØ", wakayama: "ÂíåÊ≠åÂ±±", tottori: "È≥•Âèñ", shimane: "Â≥∂Ê†π", okayama: "Â≤°Â±±", hiroshima: "Â∫ÉÂ≥∂", yamaguchi: "Â±±Âè£", tokushima: "Âæ≥Â≥∂", kagawa: "È¶ôÂ∑ù", ehime: "ÊÑõÂ™õ", kochi: "È´òÁü•", fukuoka: "Á¶èÂ≤°", saga: "‰ΩêË≥Ä", nagasaki: "Èï∑Â¥é", kumamoto: "ÁÜäÊú¨", oita: "Â§ßÂàÜ", miyazaki: "ÂÆÆÂ¥é", kagoshima: "ÈπøÂÖêÂ≥∂", okinawa: "Ê≤ñÁ∏Ñ", mars: "„Ç™„É™„É≥„Éù„ÇπÂ±±ÈÉΩÂ∏Ç (ÁÅ´Êòü)", titan: "„Çø„Ç§„Çø„É≥ÊµÆÈÅäÈÉΩÂ∏Ç", geology: "Âú∞Ë≥™Â≠¶ÁöÑÊ≠¥Âè≤" },
                geologicalData: [
                    { title: "ÂÜ•Áéã‰ª£ (Âú∞ÁêÉË™ïÁîü)", date: "Á¥Ñ46ÂÑÑÂπ¥Ââç", temp: "> 230¬∞C", icon: "üåã", description: "Ë°®Èù¢„Åå„Éû„Ç∞„Éû„ÅÆÊµ∑„ÅßË¶Ü„Çè„Çå„ÅüÁÅºÁÜ±„ÅÆÊôÇ‰ª£„ÄÇÊúà„ÅåÂΩ¢Êàê„Åï„Çå„Åü„ÅÆ„ÇÇ„Åì„ÅÆÈ†É„ÄÇ", bgColor: "bg-gradient-to-br from-red-500 to-orange-600" },
                    { title: "ÂæåÊúüÈáçÁàÜÊíÉÊúü", date: "Á¥Ñ41ÂÑÑ - 38ÂÑÑÂπ¥Ââç", temp: "È´òÊ∏©", icon: "‚òÑÔ∏è", description: "ÁÑ°Êï∞„ÅÆÂ∑®Â§ßÈöïÁü≥„ÅåÂú∞ÁêÉ„Å´Ë°ùÁ™Å„ÄÇÊµ∑„ÅÆËµ∑Ê∫ê„Å®„Å™„ÇãÊ∞¥„Åå„ÇÇ„Åü„Çâ„Åï„Çå„Åü„ÄÇ", bgColor: "bg-gradient-to-br from-gray-700 to-gray-900" },
                    { title: "ÂÖ®ÁêÉÂáçÁµê", date: "Á¥Ñ7ÂÑÑÂπ¥Ââç", temp: "Âπ≥Âùá -50¬∞C", icon: "‚ùÑÔ∏è", description: "Âú∞ÁêÉÂÖ®‰Ωì„ÅåÂéö„Åï1km„ÅÆÊ∞∑„ÅßË¶Ü„Çè„Çå„Åü„Çπ„Éé„Éº„Éú„Éº„É´„Ç¢„Éº„ÇπÊôÇ‰ª£„ÄÇ", bgColor: "bg-gradient-to-br from-blue-300 to-indigo-400" },
                    { title: "„Éë„É≥„Ç≤„Ç¢Â§ßÈô∏", date: "Á¥Ñ3ÂÑÑÂπ¥Ââç", temp: "Â§öÊßò", icon: "üåç", description: "ÂÖ®„Å¶„ÅÆÈô∏Âú∞„ÅåÈõÜÁµê„Åó„ÅüË∂ÖÂ§ßÈô∏„ÄÇÂÜÖÈô∏ÈÉ®„ÅØÂ∫ÉÂ§ß„Å™Á†ÇÊº†„ÅåÂ∫É„Åå„Å£„Å¶„ÅÑ„Åü„ÄÇ", bgColor: "bg-gradient-to-br from-yellow-600 to-green-700" },
                    { title: "ÊÅêÁ´úÁµ∂ÊªÖ (K-PgÂ¢ÉÁïå)", date: "Á¥Ñ6600‰∏áÂπ¥Ââç", temp: "ÊøÄÂ§â", icon: "ü¶ñ", description: "Â∑®Â§ßÈöïÁü≥„ÅÆË°ùÁ™Å„Å´„Çà„Çä„ÄÅÊÅêÁ´ú„ÇíÂê´„ÇÄÂÖ®ÁîüÁâ©„ÅÆÁ¥Ñ75%„ÅåÁµ∂ÊªÖ„Åó„Åü„ÄÇ", bgColor: "bg-gradient-to-br from-purple-600 to-red-700" }
                ],
                trivias: {
                    japan: ["Êó•Êú¨„Å´„ÅØÁ¥Ñ6,800„ÅÆÂ≥∂„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ", "‰∏ñÁïå„ÅßÊúÄ„ÇÇÂè§„ÅÑ‰ºöÁ§æ„ÅØÊó•Êú¨„Å´„ÅÇ„Çä„ÄÅ578Âπ¥ÂâµÊ•≠„ÅÆÈáëÂâõÁµÑ„Åß„Åô„ÄÇ", "Ëá™ÂãïË≤©Â£≤Ê©ü„ÅØÊó•Êú¨‰∏≠„Å´„ÅÇ„Çä„ÄÅ„Åù„ÅÆÊï∞„ÅØ‰∏ñÁïå‰∏Ä„Åß„Åô„ÄÇ", "Êó•Êú¨„ÅÆË≠òÂ≠óÁéá„ÅØ„Åª„Åº100%„Åß„Åô„ÄÇ", "ÊØéÂπ¥„ÄÅÊó•Êú¨„Åß„ÅØ1,500Âõû‰ª•‰∏ä„ÅÆÂú∞Èúá„ÅåË®òÈå≤„Åï„Çå„Åæ„Åô„ÄÇ", "„Ç´„É©„Ç™„Ç±„ÅØ„ÄåÁ©∫„ÅÆ„Ç™„Éº„Ç±„Çπ„Éà„É©„Äç„ÇíÊÑèÂë≥„Åô„ÇãÊó•Êú¨„ÅÆÁô∫ÊòéÂìÅ„Åß„Åô„ÄÇ", "Èùí‰ø°Âè∑„ÅØ„ÄÅ„Åó„Å∞„Åó„Å∞„ÄåÈùí„Äç„Åß„ÅØ„Å™„Åè„ÄåÁ∑ë„Äç„Å®Âëº„Å∞„Çå„Åæ„Åô„Åå„ÄÅÊ≥ïÂæã‰∏ä„ÅØÈùíËâ≤„Åß„Åô„ÄÇ", "‰∏ñÁïåÂàù„ÅÆÈï∑Á∑®Â∞èË™¨„Å®„Åï„Çå„Çã„ÄåÊ∫êÊ∞èÁâ©Ë™û„Äç„ÅØ„ÄÅ11‰∏ñÁ¥Ä„ÅÆÊó•Êú¨„ÅßÂ•≥ÊÄß„Å´„Çà„Å£„Å¶Êõ∏„Åã„Çå„Åæ„Åó„Åü„ÄÇ"],
                    mars: ["ÁÅ´Êòü„Å´„ÅØÂ§™ÈôΩÁ≥ª„ÅßÊúÄ„ÇÇÈ´ò„ÅÑÁÅ´Â±±„Äå„Ç™„É™„É≥„Éù„ÇπÂ±±„Äç„Åå„ÅÇ„Çä„ÄÅ„Åù„ÅÆÈ´ò„Åï„ÅØ„Ç®„Éô„É¨„Çπ„Éà„ÅÆÁ¥Ñ3ÂÄç„Åß„Åô„ÄÇ", "ÁÅ´Êòü„ÅÆÂ§ïÁÑº„Åë„ÅØ„ÄÅÂú∞ÁêÉ„ÅÆËµ§Ëâ≤„Å®„ÅØÂØæÁÖßÁöÑ„Å´ÈùíËâ≤„Åß„Åô„ÄÇ", "ÁÅ´Êòü„ÅÆ1Âπ¥„ÅØÂú∞ÁêÉ„ÅÆÁ¥Ñ2ÂÄç„ÄÅ687Êó•„Åß„Åô„ÄÇ"],
                    titan: ["„Çø„Ç§„Çø„É≥„ÅØÂúüÊòüÊúÄÂ§ß„ÅÆË°õÊòü„Åß„ÄÅÂ§™ÈôΩÁ≥ª„Åß„ÅØÂîØ‰∏Ä„ÄÅÂàÜÂéö„ÅÑÂ§ßÊ∞ó„ÇíÊåÅ„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ", "„Çø„Ç§„Çø„É≥„ÅÆÂú∞Ë°®„Å´„ÅØ„ÄÅ„É°„Çø„É≥„ÇÑ„Ç®„Çø„É≥„Åß„Åß„Åç„ÅüÂ∑ù„ÇÑÊπñ„ÄÅÊµ∑„ÅåÂ≠òÂú®„Åó„Åæ„Åô„ÄÇ", "„Çø„Ç§„Çø„É≥„ÅÆÂú∞Ë°®Ê∏©Â∫¶„ÅØÊëÇÊ∞è„Éû„Ç§„Éä„Çπ180Â∫¶„Å®ÈùûÂ∏∏„Å´‰Ωé„ÅÑ„Åß„Åô„ÄÇ"],
                    geology: ["Âú∞ÁêÉ„ÅÆÂπ¥ÈΩ¢„ÅØÁ¥Ñ46ÂÑÑÊ≠≥„Åß„Åô„ÄÇ", "ÁèæÂú®„ÅÆÂ§ßÈô∏„ÅØ„ÄÅ‰ªä„ÇÇÂπ¥„Å´Êï∞„Çª„É≥„ÉÅ„ÅÆ„Éö„Éº„Çπ„ÅßÁßªÂãï„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ", "ÈÖ∏Á¥†„ÅåË±äÂØå„Å™ÁèæÂú®„ÅÆÂ§ßÊ∞ó„ÅØ„ÄÅÁ¥Ñ24ÂÑÑÂπ¥Ââç„Å´„Ç∑„Ç¢„Éé„Éê„ÇØ„ÉÜ„É™„Ç¢„ÅÆÂÖâÂêàÊàê„Å´„Çà„Å£„Å¶‰Ωú„Çâ„ÇåÂßã„ÇÅ„Åæ„Åó„Åü„ÄÇ", "Âú∞ÁêÉ„ÅÆÊ≠¥Âè≤‰∏ä„ÄÅÂ§ß„Åç„Å™Â§ßÈáèÁµ∂ÊªÖ„ÅØÂ∞ë„Å™„Åè„Å®„ÇÇ5Âõû„ÅÇ„Å£„Åü„Å®„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ"]
                }
            },
            en: {
                intro: "Embark on a journey through time, from \"Today\" to \"4.6 billion years ago\".",
                title: "Weather TimeMachine",
                didYouKnow: "Did you know?",
                labels: { today: "Today", yearsAgo: "{n} Years Ago" },
                locationGroups: { japan: "Japan", scifi: "Sci-Fi Cities", geology: "Geological Ages" },
                weatherCodes: { 0: "Clear sky", 1: "Mainly clear", 2: "Partly cloudy", 3: "Overcast", 45: "Fog", 48: "Depositing rime fog", 51: "Light drizzle", 53: "Moderate drizzle", 55: "Dense drizzle", 61: "Slight rain", 63: "Moderate rain", 65: "Heavy rain", 80: "Slight rain showers", 81: "Moderate rain showers", 82: "Violent rain showers", 95: "Thunderstorm" },
                locationNames: { hokkaido: "Hokkaido", aomori: "Aomori", iwate: "Iwate", miyagi: "Miyagi", akita: "Akita", yamagata: "Yamagata", fukushima: "Fukushima", ibaraki: "Ibaraki", tochigi: "Tochigi", gunma: "Gunma", saitama: "Saitama", chiba: "Chiba", tokyo: "Tokyo", kanagawa: "Kanagawa", niigata: "Niigata", toyama: "Toyama", ishikawa: "Ishikawa", fukui: "Fukui", yamanashi: "Yamanashi", nagano: "Nagano", gifu: "Gifu", shizuoka: "Shizuoka", aichi: "Aichi", mie: "Mie", shiga: "Shiga", kyoto: "Kyoto", osaka: "Osaka", hyogo: "Hyogo", nara: "Nara", wakayama: "Wakayama", tottori: "Tottori", shimane: "Shimane", okayama: "Okayama", hiroshima: "Hiroshima", yamaguchi: "Yamaguchi", tokushima: "Tokushima", kagawa: "Kagawa", ehime: "Ehime", kochi: "Kochi", fukuoka: "Fukuoka", saga: "Saga", nagasaki: "Nagasaki", kumamoto: "Kumamoto", oita: "Oita", miyazaki: "Miyazaki", kagoshima: "Kagoshima", okinawa: "Okinawa", mars: "Olympus Mons City (Mars)", titan: "Titan Floating City", geology: "Geological History" },
                geologicalData: [
                    { title: "Hadean Eon (Earth's Birth)", date: "Approx. 4.6 billion years ago", temp: "> 230¬∞C", icon: "üåã", description: "A scorching era with a surface covered by a magma ocean. The Moon was also formed around this time.", bgColor: "bg-gradient-to-br from-red-500 to-orange-600" },
                    { title: "Late Heavy Bombardment", date: "Approx. 4.1-3.8 billion years ago", temp: "High", icon: "‚òÑÔ∏è", description: "Countless giant meteorites collided with Earth, bringing water that would form the oceans.", bgColor: "bg-gradient-to-br from-gray-700 to-gray-900" },
                    { title: "Snowball Earth", date: "Approx. 700 million years ago", temp: "Avg. -50¬∞C", icon: "‚ùÑÔ∏è", description: "An era where the entire Earth was covered in a 1km thick layer of ice.", bgColor: "bg-gradient-to-br from-blue-300 to-indigo-400" },
                    { title: "Pangaea Supercontinent", date: "Approx. 300 million years ago", temp: "Varied", icon: "üåç", description: "A supercontinent where all landmasses were gathered. The interior was a vast desert.", bgColor: "bg-gradient-to-br from-yellow-600 to-green-700" },
                    { title: "Dinosaur Extinction (K-Pg Boundary)", date: "Approx. 66 million years ago", temp: "Drastic Change", icon: "ü¶ñ", description: "A massive meteorite impact led to the extinction of about 75% of all species, including dinosaurs.", bgColor: "bg-gradient-to-br from-purple-600 to-red-700" }
                ],
                trivias: {
                    japan: ["Japan consists of about 6,800 islands.", "The world's oldest continuously operating company, Kong≈ç Gumi, is in Japan, founded in 578.", "There are more vending machines in Japan per capita than in any other country.", "Japan's literacy rate is nearly 100%.", "Over 1,500 earthquakes are recorded in Japan each year.", "Karaoke, meaning 'empty orchestra,' is a Japanese invention.", "The traffic light for 'go' is called 'ao' (blue), but it is officially green.", "The Tale of Genji, considered the world's first novel, was written in the 11th century by a Japanese woman."],
                    mars: ["Mars is home to Olympus Mons, the tallest volcano in the solar system, about three times the height of Mount Everest.", "The sunsets on Mars are blue, in contrast to the reddish sunsets on Earth.", "A year on Mars is about twice as long as an Earth year, lasting 687 days."],
                    titan: ["Titan is Saturn's largest moon and the only one in the solar system with a thick atmosphere.", "Titan's surface has rivers, lakes, and seas of liquid methane and ethane.", "The surface temperature on Titan is extremely cold, around -180 degrees Celsius."],
                    geology: ["The age of the Earth is estimated to be about 4.6 billion years.", "The continents are still moving at a rate of a few centimeters per year.", "The oxygen-rich atmosphere we have today began to form about 2.4 billion years ago due to photosynthesis by cyanobacteria.", "There have been at least five major mass extinctions in Earth's history."]
                }
            }
        };

        // „Éá„Éº„Çø„ÅÆ„Åø„ÅÆ„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà
        const locations = { hokkaido: { lat: 43.06, lon: 141.35, isSF: false, isGeological: false }, aomori: { lat: 40.82, lon: 140.74, isSF: false, isGeological: false }, iwate: { lat: 39.7, lon: 141.15, isSF: false, isGeological: false }, miyagi: { lat: 38.27, lon: 140.87, isSF: false, isGeological: false }, akita: { lat: 39.72, lon: 140.1, isSF: false, isGeological: false }, yamagata: { lat: 38.24, lon: 140.36, isSF: false, isGeological: false }, fukushima: { lat: 37.75, lon: 140.47, isSF: false, isGeological: false }, ibaraki: { lat: 36.34, lon: 140.45, isSF: false, isGeological: false }, tochigi: { lat: 36.57, lon: 139.88, isSF: false, isGeological: false }, gunma: { lat: 36.39, lon: 139.06, isSF: false, isGeological: false }, saitama: { lat: 35.86, lon: 139.65, isSF: false, isGeological: false }, chiba: { lat: 35.6, lon: 140.12, isSF: false, isGeological: false }, tokyo: { lat: 35.69, lon: 139.69, isSF: false, isGeological: false }, kanagawa: { lat: 35.45, lon: 139.64, isSF: false, isGeological: false }, niigata: { lat: 37.9, lon: 139.02, isSF: false, isGeological: false }, toyama: { lat: 36.7, lon: 137.21, isSF: false, isGeological: false }, ishikawa: { lat: 36.59, lon: 136.63, isSF: false, isGeological: false }, fukui: { lat: 36.07, lon: 136.22, isSF: false, isGeological: false }, yamanashi: { lat: 35.66, lon: 138.57, isSF: false, isGeological: false }, nagano: { lat: 36.65, lon: 138.18, isSF: false, isGeological: false }, gifu: { lat: 35.39, lon: 136.72, isSF: false, isGeological: false }, shizuoka: { lat: 34.98, lon: 138.38, isSF: false, isGeological: false }, aichi: { lat: 35.18, lon: 136.91, isSF: false, isGeological: false }, mie: { lat: 34.73, lon: 136.51, isSF: false, isGeological: false }, shiga: { lat: 35.0, lon: 135.87, isSF: false, isGeological: false }, kyoto: { lat: 35.01, lon: 135.76, isSF: false, isGeological: false }, osaka: { lat: 34.69, lon: 135.5, isSF: false, isGeological: false }, hyogo: { lat: 34.69, lon: 135.18, isSF: false, isGeological: false }, nara: { lat: 34.69, lon: 135.83, isSF: false, isGeological: false }, wakayama: { lat: 34.23, lon: 135.17, isSF: false, isGeological: false }, tottori: { lat: 35.5, lon: 134.24, isSF: false, isGeological: false }, shimane: { lat: 35.47, lon: 133.05, isSF: false, isGeological: false }, okayama: { lat: 34.66, lon: 133.93, isSF: false, isGeological: false }, hiroshima: { lat: 34.4, lon: 132.46, isSF: false, isGeological: false }, yamaguchi: { lat: 34.19, lon: 131.47, isSF: false, isGeological: false }, tokushima: { lat: 34.07, lon: 134.56, isSF: false, isGeological: false }, kagawa: { lat: 34.34, lon: 134.04, isSF: false, isGeological: false }, ehime: { lat: 33.84, lon: 132.77, isSF: false, isGeological: false }, kochi: { lat: 33.56, lon: 133.53, isSF: false, isGeological: false }, fukuoka: { lat: 33.59, lon: 130.4, isSF: false, isGeological: false }, saga: { lat: 33.25, lon: 130.3, isSF: false, isGeological: false }, nagasaki: { lat: 32.75, lon: 129.87, isSF: false, isGeological: false }, kumamoto: { lat: 32.8, lon: 130.7, isSF: false, isGeological: false }, oita: { lat: 33.24, lon: 131.61, isSF: false, isGeological: false }, miyazaki: { lat: 31.91, lon: 131.42, isSF: false, isGeological: false }, kagoshima: { lat: 31.56, lon: 130.56, isSF: false, isGeological: false }, okinawa: { lat: 26.21, lon: 127.68, isSF: false, isGeological: false }, mars: { isSF: true, isGeological: false }, titan: { isSF: true, isGeological: false }, geology: { isSF: false, isGeological: true } };
        const WMO_ICONS = { 0: '‚òÄÔ∏è', 1: 'üå§Ô∏è', 2: '‚õÖÔ∏è', 3: '‚òÅÔ∏è', 45: 'üå´Ô∏è', 48: 'üå´Ô∏è', 51: 'üå¶Ô∏è', 53: 'üå¶Ô∏è', 55: 'üå¶Ô∏è', 61: 'üåßÔ∏è', 63: 'üåßÔ∏è', 65: 'üåßÔ∏è', 80: 'üåßÔ∏è', 81: 'üåßÔ∏è', 82: '‚õàÔ∏è', 95: '‚õàÔ∏è' };

        function setLanguage(lang) {
            currentLang = lang;
            const T = translations[lang];
            document.documentElement.lang = lang;
            introText.textContent = T.intro;
            mainTitle.textContent = T.title;
            triviaTitle.textContent = T.didYouKnow;
            
            populateLocationSelector();
            updateUI();
        }

        function populateLocationSelector() {
            const T = translations[currentLang];
            japanLocationsGroup.label = T.locationGroups.japan;
            scifiLocationsGroup.label = T.locationGroups.scifi;
            geologyLocationsGroup.label = T.locationGroups.geology;
            
            [japanLocationsGroup, scifiLocationsGroup, geologyLocationsGroup].forEach(g => g.innerHTML = '');

            for (const key in locations) {
                const location = locations[key];
                const option = document.createElement('option');
                option.value = key;
                option.textContent = T.locationNames[key];

                if (location.isGeological) {
                    geologyLocationsGroup.appendChild(option);
                } else if (location.isSF) {
                    scifiLocationsGroup.appendChild(option);
                } else {
                    japanLocationsGroup.appendChild(option);
                }
            }
        }
        
        async function fetchForecastWeather(lat, lon) { /* ... */ }
        async function fetchArchiveWeather(lat, lon, date) { /* ... */ }

        function createWeatherCard(data, offset, baseTemp) {
            const T = translations[currentLang];
            if (!data) {
                return `<div class="weather-card bg-gray-200 dark:bg-gray-800 rounded-xl shadow-lg p-6 flex flex-col justify-center items-center text-center"><h2 class="text-xl font-bold text-gray-700 dark:text-gray-300">${offset.label}</h2><p class="mt-4 text-gray-500">No data available</p></div>`;
            }
            const maxTemp = data.maxTemp, minTemp = data.minTemp;
            const isMaxTempNumber = typeof maxTemp === 'number', isMinTempNumber = typeof minTemp === 'number';
            const maxTempText = isMaxTempNumber ? `${maxTemp.toFixed(1)}¬∞` : 'N/A';
            const minTempText = isMinTempNumber ? `${minTemp.toFixed(1)}¬∞` : 'N/A';
            const avgTemp = (isMaxTempNumber && isMinTempNumber) ? (maxTemp + minTemp) / 2 : null;
            const isAvgTempNumber = typeof avgTemp === 'number';
            const avgTempText = isAvgTempNumber ? `${avgTemp.toFixed(1)}¬∞C` : 'N/A';
            const bgColor = isAvgTempNumber ? getTempColor(avgTemp) : 'rgb(229, 231, 235)';
            const weatherInfo = { icon: WMO_ICONS[data.weatherCode] || '‚ùì', description: T.weatherCodes[data.weatherCode] || 'Unknown' };
            let trendHtml = '';
            if (baseTemp !== null && isAvgTempNumber && offset.years > 0) {
                const diff = avgTemp - baseTemp;
                const trendIcon = diff > 0 ? 'üîº' : 'üîΩ';
                const trendColor = diff > 0 ? 'text-red-500' : 'text-blue-500';
                trendHtml = `<div class="trend ${trendColor} font-semibold">${trendIcon} ${diff.toFixed(1)}¬∞C</div>`;
            }
            return `<div class="weather-card bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 flex flex-col justify-between items-center text-center" style="background-color: ${bgColor};"><div class="w-full"><h2 class="text-xl font-bold text-gray-800">${offset.label}</h2><p class="text-sm text-gray-600">${data.date || ''}</p></div><div class="my-4"><span class="text-6xl">${weatherInfo.icon}</span><p class="text-gray-700 font-medium">${weatherInfo.description}</p></div><div class="w-full"><div class="text-4xl font-bold text-gray-900">${avgTempText}</div><div class="text-gray-600"><span>H: ${maxTempText}</span> / <span>L: ${minTempText}</span></div>${trendHtml}</div></div>`;
        }

        function createGeologicalCard(data) {
            return `<div class="geo-card ${data.bgColor} text-white rounded-xl shadow-lg p-6 flex flex-col justify-between items-center text-center"><div class="w-full"><h2 class="text-xl font-bold">${data.title}</h2><p class="text-sm opacity-80">${data.date}</p></div><div class="my-4"><span class="text-6xl">${data.icon}</span><p class="font-medium mt-2">${data.temp}</p></div><p class="text-sm text-center">${data.description}</p></div>`;
        }

        function renderGeologicalCards() {
            const T = translations[currentLang];
            cardsContainer.innerHTML = '';
            T.geologicalData.forEach(data => {
                cardsContainer.innerHTML += createGeologicalCard(data);
            });
        }

        async function updateUI() {
            const locationData = locations[locationSelector.value];
            document.body.classList.toggle('font-orbitron', locationData.isSF || locationData.isGeological);
            datePicker.style.display = locationData.isGeological ? 'none' : 'block';
            if (locationData.isGeological) {
                renderGeologicalCards();
                updateTrivia();
                return;
            }
            cardsContainer.innerHTML = Array(5).fill(createSkeletonCard()).join('');
            const today = new Date();
            const todayLocalString = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
            const isDateToday = datePicker.value === todayLocalString;
            let firstCardData;
            if (isDateToday) {
                firstCardData = await fetchForecastWeather(locationData.lat, locationData.lon);
            } else {
                firstCardData = await fetchArchiveWeather(locationData.lat, locationData.lon, datePicker.value);
            }
            const baseTemp = (firstCardData && typeof firstCardData.maxTemp === 'number' && typeof firstCardData.minTemp === 'number') ? (firstCardData.maxTemp + firstCardData.minTemp) / 2 : null;
            const T = translations[currentLang];
            const dateOffsets = [
                { label: T.labels.today, years: 0 },
                { label: T.labels.yearsAgo.replace('{n}', 5), years: 5 },
                { label: T.labels.yearsAgo.replace('{n}', 10), years: 10 },
                { label: T.labels.yearsAgo.replace('{n}', 20), years: 20 },
                { label: T.labels.yearsAgo.replace('{n}', 30), years: 30 }
            ];
            cardsContainer.children[0].outerHTML = createWeatherCard(firstCardData, dateOffsets[0], baseTemp);
            const dateParts = datePicker.value.split('-').map(Number);
            const selectedDate = new Date(dateParts[0], dateParts[1] - 1, dateParts[2]);
            const pastDataPromises = dateOffsets.slice(1).map(offset => {
                const targetDate = new Date(selectedDate);
                targetDate.setFullYear(targetDate.getFullYear() - offset.years);
                const dateString = `${targetDate.getFullYear()}-${String(targetDate.getMonth() + 1).padStart(2, '0')}-${String(targetDate.getDate()).padStart(2, '0')}`;
                return fetchArchiveWeather(locationData.lat, locationData.lon, dateString);
            });
            const pastDataResults = await Promise.all(pastDataPromises);
            pastDataResults.forEach((data, index) => {
                 cardsContainer.children[index + 1].outerHTML = createWeatherCard(data, dateOffsets[index + 1], baseTemp);
            });
            updateTrivia();
        }

        function updateTrivia() {
            const locationData = locations[locationSelector.value];
            let triviaKey = 'japan';
            if (locationData.isGeological) {
                triviaKey = 'geology';
            } else if (locationData.isSF) {
                triviaKey = locationSelector.value;
            }
            const locationTrivias = translations[currentLang].trivias[triviaKey];
            const randomIndex = Math.floor(Math.random() * locationTrivias.length);
            triviaContainer.style.opacity = 0;
            setTimeout(() => {
                triviaText.textContent = locationTrivias[randomIndex];
                triviaContainer.style.opacity = 1;
            }, 300);
        }

        function init() {
            const today = new Date();
            datePicker.value = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
            languageSelector.addEventListener('change', (e) => setLanguage(e.target.value));
            locationSelector.addEventListener('change', updateUI);
            datePicker.addEventListener('change', updateUI);
            setLanguage('ja'); // ÂàùÊúüË®ÄË™û„ÇíÊó•Êú¨Ë™û„Å´Ë®≠ÂÆö
        }

        document.addEventListener('DOMContentLoaded', init);

        // Â§âÊõ¥„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÈñ¢Êï∞
        getTempColor = function(temp) { const locationData = locations[locationSelector.value]; const minTemp = locationData.isSF ? -100 : -10; const maxTemp = locationData.isSF ? 0 : 40; const normalizedTemp = Math.max(0, Math.min(1, (temp - minTemp) / (maxTemp - minTemp))); const hue = 240 - (normalizedTemp * 240); const saturation = locationData.isSF ? 95 : 70; const lightness = locationData.isSF ? 60 : 80; return `hsl(${hue}, ${saturation}%, ${lightness}%)`; };
        fetchForecastWeather = async function(lat, lon) { const apiUrl = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&daily=weathercode,temperature_2m_max,temperature_2m_min&timezone=auto`; try { const response = await fetch(apiUrl); if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`); const data = await response.json(); if (data.daily && data.daily.time.length > 0) { return { date: data.daily.time[0], maxTemp: data.daily.temperature_2m_max[0], minTemp: data.daily.temperature_2m_min[0], weatherCode: data.daily.weathercode[0] }; } return null; } catch (error) { console.error("Failed to fetch forecast data:", error); return null; } };
        fetchArchiveWeather = async function(lat, lon, date) { const apiUrl = `https://archive-api.open-meteo.com/v1/archive?latitude=${lat}&longitude=${lon}&start_date=${date}&end_date=${date}&daily=weathercode,temperature_2m_max,temperature_2m_min&timezone=auto`; try { const response = await fetch(apiUrl); if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`); const data = await response.json(); if (data.daily && data.daily.time.length > 0) { return { date: data.daily.time[0], maxTemp: data.daily.temperature_2m_max[0], minTemp: data.daily.temperature_2m_min[0], weatherCode: data.daily.weathercode[0] }; } return null; } catch (error) { console.error("Failed to fetch archive weather data:", error); return null; } };
        createSkeletonCard = function() { return `<div class="skeleton-card bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 flex flex-col justify-between items-center text-center"><div class="w-full"><div class="pulse bg-gray-300 dark:bg-gray-700 h-7 w-3/4 mx-auto rounded"></div><div class="pulse bg-gray-300 dark:bg-gray-700 h-4 w-1/2 mx-auto rounded mt-2"></div></div><div class="my-4"><div class="pulse bg-gray-300 dark:bg-gray-700 h-20 w-20 mx-auto rounded-full"></div><div class="pulse bg-gray-300 dark:bg-gray-700 h-5 w-2/3 mx-auto rounded mt-3"></div></div><div class="w-full"><div class="pulse bg-gray-300 dark:bg-gray-700 h-10 w-1/2 mx-auto rounded"></div><div class="pulse bg-gray-300 dark:bg-gray-700 h-5 w-3/4 mx-auto rounded mt-2"></div></div></div>`; };
    </script>
</body>
</html>
